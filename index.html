<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGIS Radar Cuaca Real-Time</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 600px; width: 100%; border-radius: 10px; }
        body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
        .info-box { background: white; padding: 10px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <h2>Monitoring Radar & Cuaca Wisata (Real-Time)</h2>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const API_KEY = 'c7072f637f3e10343fcf2dad07423a11';

        // 1. Basemaps
        const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OSM' });
        const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: '© Esri' });

        const map = L.map('map', {
            center: [-7.9, 112.6],
            zoom: 8,
            layers: [osm]
        });

        // 2. Lapisan Radar (Overlays)
        const radarHujan = L.tileLayer(`https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${API_KEY}`, { opacity: 0.6 });
        const radarSuhu = L.tileLayer(`https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=${API_KEY}`, { opacity: 0.6 });
        const radarAngin = L.tileLayer(`https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=${API_KEY}`, { opacity: 0.6 });

        // 3. Daftar Lokasi (Kembali ditambahkan agar tidak hilang)
        const lokasiWisata = [
            { nama: "Pantai Balekambang", lat: -8.402778, lon: 112.538889 },
            { nama: "Area Riset Tuban", lat: -6.9015, lon: 112.0620 },
            { nama: "Gili Ketapang", lat: -7.6833, lon: 113.2500 },
            { nama: "Gunung Bromo", lat: -7.9425, lon: 112.9530 }
        ];

        // 4. Fungsi Menampilkan Marker & Data Cuaca
        lokasiWisata.forEach(wisata => {
            const url = `https://api.openweathermap.org/data/2.5/weather?lat=${wisata.lat}&lon=${wisata.lon}&appid=${API_KEY}&units=metric&lang=id`;
            fetch(url).then(res => res.json()).then(data => {
                const marker = L.marker([wisata.lat, wisata.lon]).addTo(map);
                marker.bindTooltip(wisata.nama, {permanent: true, direction: 'top'}).openTooltip();
                marker.bindPopup(`<b>${wisata.nama}</b><br>Suhu: ${data.main.temp}°C<br>Angin: ${data.wind.speed} m/s`);
            });
        });

        // 5. Tombol Kontrol (Pojok Kanan Atas)
        const baseMaps = { "Peta Jalan": osm, "Satelit": satellite };
        const overlayMaps = { "Radar Hujan": radarHujan, "Radar Suhu": radarSuhu, "Radar Angin": radarAngin };
        L.control.layers(baseMaps, overlayMaps).addTo(map);

        // Aktifkan radar hujan secara default
        radarHujan.addTo(map);
    </script>
</body>
</html>
