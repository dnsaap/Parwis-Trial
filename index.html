<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>South Coast Guardian | WebGIS & Analytics</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root { --primary: #1a73e8; --dark: #2c3e50; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; scroll-behavior: smooth; overflow-x: hidden; }
        
        /* Navbar */
        nav { 
            position: fixed; top: 0; width: 100%; background: rgba(44, 62, 80, 0.95); 
            display: flex; justify-content: space-around; padding: 15px 0; z-index: 2000;
        }
        nav a { color: white; text-decoration: none; font-weight: bold; font-size: 0.9rem; }

        /* Section Layout */
        section { padding: 80px 10% 40px 10%; min-height: 80vh; }

        #beranda { 
            height: 100vh; padding: 0;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), 
                        url('https://c.pxhere.com/photos/58/94/beach_coast_HD_wallpaper_sand_sea_summer_vacation_water-915974.jpg!d');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center;
        }

        #visualisasi { height: 100vh; display: flex; padding: 50px 0 0 0; background: #fff; }
        #sidebar { width: 380px; background: white; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); overflow-y: auto; z-index: 1000; }
        #map { flex-grow: 1; height: calc(100vh - 50px); }

        /* UI Components */
        .data-card { background: var(--light); border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid var(--primary); }
        .chart-container { margin-top: 15px; height: 200px; }
        
        .rain-legend { background: white; padding: 12px; border-radius: 5px; box-shadow: 0 0 10px rgba(0,0,0,0.2); width: 280px; }
        .rain-bar { width: 100%; height: 12px; background: linear-gradient(to right, #FFFF00, #00FF00, #0000FF, #4B0082); margin: 10px 0; border-radius: 3px; }
        .rain-labels { display: flex; justify-content: space-between; font-size: 11px; font-weight: bold; color: #444; }

        .status-nyaman { color: #28a745; font-weight: bold; }
        .status-ok { color: #fd7e14; font-weight: bold; }
        .status-panas { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>

    <nav>
        <div style="color: white; font-weight: bold;">SC-GUARDIAN</div>
        <div style="display: flex; gap: 20px;">
            <a href="#beranda">BERANDA</a>
            <a href="#metodologi">METODOLOGI</a>
            <a href="#visualisasi">VISUALISASI</a>
            <a href="#tentang">TENTANG KAMI</a>
        </div>
    </nav>

    <section id="beranda">
        <h1>SOUTH COAST GUARDIAN</h1>
        <p>Dashboard Monitoring Cuaca & Analisis Kenyamanan Pesisir Selatan Jawa Timur.</p>
        <a href="#visualisasi" style="background: var(--primary); color: white; padding: 12px 25px; border-radius: 30px; text-decoration: none; margin-top: 20px; font-weight: bold;">Mulai Visualisasi</a>
    </section>

    <section id="metodologi">
        <h2>Metodologi & Parameter</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div class="data-card">
                <h3>1. Integrasi API</h3>
                <p>Data dikumpulkan melalui <b>OpenWeatherMap API v2.5</b> yang menyediakan informasi meteorologi dari stasiun cuaca terdekat secara real-time.</p>
            </div>
            <div class="data-card">
                <h3>2. Algoritma Humidex</h3>
                <p>Indeks kenyamanan dihitung dengan rumus korelasi antara suhu udara dan titik embun untuk mengukur tingkat stres panas pada manusia.</p>
            </div>
            <div class="data-card">
                <h3>3. Visualisasi Radar</h3>
                <p>Menggunakan layer raster <i>precipitation_new</i> untuk memetakan distribusi spasial curah hujan di atas peta dasar (Basemap).</p>
            </div>
        </div>
    </section>

    <section id="visualisasi">
        <div id="sidebar">
            <h3>Analisis Lokasi</h3>
            <div id="info-panel" class="data-card">
                <div id="instruction">Klik marker pada peta untuk melihat tren data.</div>
                <div id="detail-content" style="display:none;">
                    <b id="loc-name" style="font-size: 1.2rem; color: var(--primary);"></b><br>
                    <small id="loc-time" style="color: #888;"></small><hr>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div>üå°Ô∏è Suhu: <span id="loc-temp"></span>¬∞C</div>
                        <div>üíß Lembab: <span id="loc-hum"></span>%</div>
                        <div>üí® Angin: <span id="loc-wind"></span> m/s</div>
                        <div>üìä Status: <span id="loc-status"></span></div>
                    </div>

                    <div class="chart-container">
                        <canvas id="tempChart"></canvas>
                    </div>
                    <p style="font-size: 0.7rem; color: #999; text-align: center; margin-top: 10px;">*Grafik: Prediksi suhu 24 jam ke depan</p>
                </div>
            </div>
            <div class="data-card">
                <h4>Legenda Radar</h4>
                <p style="font-size: 0.8rem;">Warna pada peta menunjukkan intensitas awan hujan saat ini.</p>
            </div>
        </div>
        <div id="map"></div>
    </section>

    <section id="tentang" style="background: var(--dark); color: white; text-align: center;">
        <h2>Tentang Kami</h2>
        <p>Dikembangkan oleh Tim Mahasiswa Geografi untuk optimalisasi teknologi informasi geospasial di sektor pariwisata.</p>
        <p>¬© 2026 South Coast Guardian Project</p>
    </section>

    <script>
        const API_KEY = 'c7072f637f3e10343fcf2dad07423a11';
        const map = L.map('map').setView([-8.41, 112.55], 11);
        let myChart = null; // Variabel untuk menyimpan instance grafik

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        L.tileLayer(`https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${API_KEY}`, { opacity: 0.5 }).addTo(map);

        L.control.scale({ imperial: false, position: 'bottomleft' }).addTo(map);

        // North Arrow & Legend
        const north = L.control({position: 'topright'});
        north.onAdd = () => {
            const div = L.DomUtil.create('div');
            div.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Compass_rose_brown_north.png" width="50">';
            return div;
        };
        north.addTo(map);

        const rainLegend = L.control({position: 'bottomright'});
        rainLegend.onAdd = () => {
            const div = L.DomUtil.create('div', 'rain-legend');
            div.innerHTML = '<b>Intensitas Curah Hujan</b><div class="rain-bar"></div>' +
                           '<div class="rain-labels"><span>Ringan</span><span>Sedang</span><span>Lebat</span><span>Sangat Lebat</span></div>';
            return div;
        };
        rainLegend.addTo(map);

        const lokasiWisata = [
            { nama: "Pantai Modangan", lat: -8.343889, lon: 112.367500 },
            { nama: "Pantai Ngliyep", lat: -8.379167, lon: 112.422500 },
            { nama: "Pantai Balekambang", lat: -8.402778, lon: 112.538889 },
            { nama: "Pantai Ngantep", lat: -8.407778, lon: 112.575000 },
            { nama: "Pantai Batu Bengkung", lat: -8.428611, lon: 112.615000 },
            { nama: "Pantai Tanjung Penyu", lat: -8.440000, lon: 112.643056 }
        ];

        function hitungKenyamanan(temp, hum) {
            const h = temp + (0.5555 * (6.11 * Math.exp(5417.75 * (1/273.16 - 1/(273.15 + temp))) - 10));
            if (h < 29) return { label: "Nyaman", kelas: "status-nyaman" };
            if (h < 40) return { label: "Cukup", kelas: "status-ok" };
            return { label: "Tidak Nyaman", kelas: "status-panas" };
        }

        // Fungsi Update Grafik
        function updateChart(labels, temps) {
            const ctx = document.getElementById('tempChart').getContext('2d');
            if (myChart) myChart.destroy(); // Hapus grafik lama sebelum membuat yang baru
            
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Suhu (¬∞C)',
                        data: temps,
                        borderColor: '#1a73e8',
                        backgroundColor: 'rgba(26, 115, 232, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false }, x: { ticks: { font: { size: 9 } } } }
                }
            });
        }

        lokasiWisata.forEach(wisata => {
            const marker = L.marker([wisata.lat, wisata.lon]).addTo(map);
            
            marker.on('click', function() {
                // 1. Ambil Data Cuaca Sekarang
                fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${wisata.lat}&lon=${wisata.lon}&appid=${API_KEY}&units=metric&lang=id`)
                .then(res => res.json()).then(data => {
                    const kenyamanan = hitungKenyamanan(data.main.temp, data.main.humidity);
                    document.getElementById('instruction').style.display = 'none';
                    document.getElementById('detail-content').style.display = 'block';
                    document.getElementById('loc-name').innerText = wisata.nama;
                    document.getElementById('loc-temp').innerText = data.main.temp;
                    document.getElementById('loc-hum').innerText = data.main.humidity;
                    document.getElementById('loc-wind').innerText = data.wind.speed;
                    document.getElementById('loc-status').innerText = kenyamanan.label;
                    document.getElementById('loc-status').className = kenyamanan.kelas;
                });

                // 2. Ambil Data Forecast untuk Grafik (Prediksi 24 Jam)
                fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${wisata.lat}&lon=${wisata.lon}&appid=${API_KEY}&units=metric`)
                .then(res => res.json()).then(data => {
                    const labels = [];
                    const temps = [];
                    // Ambil 8 data pertama (3 jam * 8 = 24 jam)
                    for(let i=0; i<8; i++) {
                        const date = new Date(data.list[i].dt * 1000);
                        labels.push(date.getHours() + ":00");
                        temps.push(data.list[i].main.temp);
                    }
                    updateChart(labels, temps);
                });
            });
        });
    </script>
</body>
</html>
