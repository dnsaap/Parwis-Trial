<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>South Coast Guardian Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; background: #f0f2f5; }
        
        #sidebar { 
            width: 350px; background: white; padding: 20px; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 1000; overflow-y: auto;
        }

        #map { flex-grow: 1; height: 100vh; }

        h1 { font-size: 1.4rem; color: #1a73e8; margin-bottom: 5px; }
        .data-card { background: #f8f9fa; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #1a73e8; }
        
        /* Skala Bar Hujan di Peta */
        .rain-legend {
            background: white; padding: 10px; border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2); line-height: 1.5;
        }
        .rain-bar {
            width: 100%; height: 10px; 
            background: linear-gradient(to right, #FFFF00, #00FF00, #0000FF, #4B0082);
            margin: 5px 0; border-radius: 2px;
        }
        .rain-labels { display: flex; justify-content: space-between; font-size: 10px; color: #555; }

        .status-nyaman { color: #28a745; font-weight: bold; }
        .status-ok { color: #fd7e14; font-weight: bold; }
        .status-panas { color: #dc3545; font-weight: bold; }
        .timestamp { font-size: 0.8rem; color: #888; margin-top: 5px; display: block; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h1>South Coast Guardian</h1>
        <p style="font-size: 0.9rem; color: #666;">Smart Tourism Safety Hub</p>
        <hr>

        <div class="data-card" id="info-panel">
            <h3>Detail Lokasi</h3>
            <div id="instruction">Klik marker pada peta untuk detail.</div>
            <div id="detail-content" style="display:none;">
                <b id="loc-name" style="font-size: 1.1rem;"></b><br>
                <span id="loc-time" class="timestamp"></span><hr>
                üå°Ô∏è Suhu: <span id="loc-temp"></span>¬∞C <br>
                üíß Kelembaban: <span id="loc-hum"></span>% <br>
                üí® Angin: <span id="loc-wind"></span> m/s <br>
                üìä Indeks: <span id="loc-status"></span>
            </div>
        </div>

        <div class="data-card">
            <h3>Metodologi</h3>
            <p style="font-size: 0.8rem;">Klasifikasi kenyamanan fisik wisatawan dihitung real-time menggunakan korelasi suhu dan kelembaban udara (Humidex).</p>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const API_KEY = 'c7072f637f3e10343fcf2dad07423a11';
        const map = L.map('map').setView([-8.41, 112.55], 11);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OSM' }).addTo(map);

        // Radar Hujan
        L.tileLayer(`https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${API_KEY}`, { opacity: 0.5 }).addTo(map);

        // 1. TAMBAH SKALA (Scale Bar)
        L.control.scale({ imperial: false, position: 'bottomleft' }).addTo(map);

        // 2. TAMBAH MATA ANGIN (North Arrow - Menggunakan Gambar Static)
        const north = L.control({position: 'topright'});
        north.onAdd = function() {
            const div = L.DomUtil.create('div', 'info');
            div.innerHTML = '<img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Compass_rose_brown_north.png" width="50" style="filter: drop-shadow(0 0 2px white);">';
            return div;
        };
        north.addTo(map);

        // 3. TAMBAH LEGENDA RENTANG SKALA BAR DI PETA
        const rainLegend = L.control({position: 'bottomright'});
        rainLegend.onAdd = function() {
            const div = L.DomUtil.create('div', 'rain-legend');
            div.innerHTML = '<b>Intensitas Hujan</b><div class="rain-bar"></div>' +
                           '<div class="rain-labels"><span>Ringan</span><span>Sedang</span><span>Lebat</span><span>Sangat Lebat</span></div>';
            return div;
        };
        rainLegend.addTo(map);

        const lokasiWisata = [
            { nama: "Pantai Modangan", lat: -8.343889, lon: 112.367500 },
            { nama: "Pantai Ngliyep", lat: -8.379167, lon: 112.422500 },
            { nama: "Pantai Balekambang", lat: -8.402778, lon: 112.538889 },
            { nama: "Pantai Ngantep", lat: -8.407778, lon: 112.575000 },
            { nama: "Pantai Batu Bengkung", lat: -8.428611, lon: 112.615000 },
            { nama: "Pantai Tanjung Penyu", lat: -8.440000, lon: 112.643056 }
        ];

        function hitungKenyamanan(temp, hum) {
            const h = temp + (0.5555 * (6.11 * Math.exp(5417.75 * (1/273.16 - 1/(273.15 + temp))) - 10));
            if (h < 29) return { label: "Sangat Nyaman", kelas: "status-nyaman" };
            if (h >= 29 && h < 40) return { label: "Nyaman / Cukup", kelas: "status-ok" };
            return { label: "Tidak Nyaman", kelas: "status-panas" };
        }

        lokasiWisata.forEach(wisata => {
            const url = `https://api.openweathermap.org/data/2.5/weather?lat=${wisata.lat}&lon=${wisata.lon}&appid=${API_KEY}&units=metric&lang=id`;
            
            fetch(url).then(res => res.json()).then(data => {
                const temp = data.main.temp;
                const hum = data.main.humidity;
                const wind = data.wind.speed;
                
                // FORMAT WAKTU DATA
                const date = new Date(data.dt * 1000);
                const jam = date.getHours().toString().padStart(2, '0') + ":" + date.getMinutes().toString().padStart(2, '0');
                
                const kenyamanan = hitungKenyamanan(temp, hum);

                const marker = L.marker([wisata.lat, wisata.lon]).addTo(map);
                marker.on('click', function() {
                    document.getElementById('instruction').style.display = 'none';
                    document.getElementById('detail-content').style.display = 'block';
                    document.getElementById('loc-name').innerText = wisata.nama;
                    document.getElementById('loc-time').innerText = "Data diperbarui: Pukul " + jam + " WIB";
                    document.getElementById('loc-temp').innerText = temp;
                    document.getElementById('loc-hum').innerText = hum;
                    document.getElementById('loc-wind').innerText = wind;
                    document.getElementById('loc-status').innerText = kenyamanan.label;
                    document.getElementById('loc-status').className = kenyamanan.kelas;
                });
            });
        });
    </script>
</body>
</html>
